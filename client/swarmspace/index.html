<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swarm Space RPG - Session Tracker</title>
    <link rel="stylesheet" href="/shared/common.css">
    <link rel="stylesheet" href="/swarmspace/swarmspace.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Swarm Space RPG</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" id="exportBtn">Export Markdown</button>
            </div>
        </header>

        <!-- Session metadata -->
        <div class="session-meta card">
            <input type="text" class="session-title input" id="sessionTitle" placeholder="Session Title (e.g., Session 1/24/2026)">
            <textarea class="session-setting input" id="sessionSetting" placeholder="Setting description..."></textarea>
            <div class="starting-week-row">
                <label for="startingWeek">Starting Week:</label>
                <input type="number" class="input starting-week-input" id="startingWeek" min="1" value="1">
            </div>
        </div>

        <!-- Weeks timeline -->
        <div id="weeksContainer">
            <div class="loading">Loading session...</div>
        </div>

        <button class="btn btn-primary add-week-btn" id="addWeekBtn">+ Add Week</button>

        <!-- Summary panels -->
        <div class="summary-panels">
            <div class="summary-panel card">
                <h3>Projects</h3>
                <div id="projectsSummary"></div>
            </div>
            <div class="summary-panel card">
                <h3>Scarcities</h3>
                <div id="scarcitiesSummary"></div>
                <button class="btn btn-secondary btn-small" id="addScarcityBtn">+ Scarcity</button>
            </div>
            <div class="summary-panel card">
                <h3>Abundances</h3>
                <div id="abundancesSummary"></div>
                <button class="btn btn-secondary btn-small" id="addAbundanceBtn">+ Abundance</button>
            </div>
            <div class="summary-panel card">
                <h3>Locations</h3>
                <div id="locationsSummary"></div>
                <button class="btn btn-secondary btn-small" id="addLocationBtn">+ Location</button>
            </div>
            <div class="summary-panel card">
                <h3>Names</h3>
                <div id="namesSummary"></div>
                <button class="btn btn-secondary btn-small" id="addNameBtn">+ Name</button>
            </div>
        </div>

        <!-- Import section -->
        <div class="import-section card">
            <button class="btn btn-secondary" id="importPreviousBtn">Import from Previous Session</button>
        </div>
    </div>

    <div class="saving-indicator" id="savingIndicator">Saving...</div>
    <div id="syncStatus" class="sync-status" onclick="SwarmSpaceUI.manualRefresh()">Synced</div>
    <div id="errorDisplay" class="error-display"></div>

    <!-- Comment modal -->
    <div class="modal-overlay" id="commentModal">
        <div class="modal">
            <h3 id="commentModalTitle">Add Comment</h3>
            <textarea id="commentText" placeholder="Your comment..." rows="3"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelCommentBtn">Cancel</button>
                <button class="modal-btn primary" id="saveCommentBtn">Add</button>
            </div>
        </div>
    </div>

    <!-- Project modal -->
    <div class="modal-overlay" id="projectModal">
        <div class="modal">
            <h3>Start Project</h3>
            <input type="text" id="projectName" placeholder="Project name..." autocomplete="off">
            <div class="form-row">
                <label>Duration (weeks):</label>
                <input type="number" id="projectDuration" min="1" value="1">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelProjectBtn">Cancel</button>
                <button class="modal-btn primary" id="saveProjectBtn">Start Project</button>
            </div>
        </div>
    </div>

    <!-- Completion modal (for manual completions) -->
    <div class="modal-overlay" id="completionModal">
        <div class="modal">
            <h3>Add Completion</h3>
            <input type="text" id="completionName" placeholder="What was completed..." autocomplete="off">
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelCompletionBtn">Cancel</button>
                <button class="modal-btn primary" id="saveCompletionBtn">Add</button>
            </div>
        </div>
    </div>

    <!-- Resource modal -->
    <div class="modal-overlay" id="resourceModal">
        <div class="modal">
            <h3 id="resourceModalTitle">Add Resource</h3>
            <input type="text" id="resourceName" placeholder="Resource name..." autocomplete="off">
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelResourceBtn">Cancel</button>
                <button class="modal-btn primary" id="saveResourceBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Location modal -->
    <div class="modal-overlay" id="locationModal">
        <div class="modal">
            <h3 id="locationModalTitle">Add Location</h3>
            <input type="text" id="locationName" placeholder="Location name..." autocomplete="off">
            <input type="text" id="locationDistance" placeholder="Distance (e.g., 7 weeks)..." autocomplete="off">
            <textarea id="locationNotes" placeholder="Notes..." rows="2"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelLocationBtn">Cancel</button>
                <button class="modal-btn primary" id="saveLocationBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Export modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal modal-wide">
            <h3>Export Markdown</h3>
            <textarea id="exportOutput" readonly rows="20"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="closeExportBtn">Close</button>
                <button class="modal-btn primary" id="copyExportBtn">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- Name modal -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal">
            <h3 id="nameModalTitle">Add Name</h3>
            <input type="text" id="nameValue" placeholder="Name..." autocomplete="off">
            <input type="text" id="nameDescription" placeholder="Description (optional)..." autocomplete="off">
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelNameBtn">Cancel</button>
                <button class="modal-btn primary" id="saveNameBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Import modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal modal-wide">
            <h3>Import from Previous Session</h3>
            <p class="modal-hint">Paste the exported markdown from a previous session. This will import active projects, scarcities, abundances, locations, and names.</p>
            <textarea id="importInput" placeholder="Paste markdown here..." rows="15"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelImportBtn">Cancel</button>
                <button class="modal-btn primary" id="doImportBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/version.js"></script>
    <script src="/config.js"></script>
    <script src="/shared/utils.js"></script>
    <script src="/shared/api.js"></script>
    <script src="/swarmspace/swarmspace-store.js"></script>
    <script src="/swarmspace/sync.js"></script>
    <script src="/swarmspace/swarmspace.js"></script>
    <script>
        if (hasExplicitListName()) {
            SwarmSpaceUI.init(getListName());
        } else {
            SwarmSpaceUI.showListSelector();
        }
    </script>
</body>
</html>
